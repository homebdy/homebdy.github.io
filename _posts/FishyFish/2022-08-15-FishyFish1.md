---
layout: post
title:  "[Fishy Fish] Backend - ë¡œê·¸ì¸ íšŒì›ê°€ì… í˜ì´ì§€"
author: yj
category: [ Fishy Fish ğŸ£ ]
tags: [ Python, Backend, Fishy Fish ]
---

### 1. íšŒì› ê°€ì…

- íšŒì› ê°€ì…ì„ í•  ê²½ìš°ì—ëŠ” ì‚¬ìš©ìì˜ email, password, usernameì„ ì…ë ¥ë°›ëŠ”ë‹¤
- passwordëŠ” bcryptë°©ì‹ì˜ ì•”í˜¸í™”ë¥¼ ì§„í–‰í•˜ì—¬ DBì— ì €ì¥í•œë‹¤.
- bcrypt ì•”í˜¸í™”ë¥¼ í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•˜ëŠ” ê²½ìš° ê´€ë¦¬í•˜ëŠ” ì‚¬ëŒë„ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤.
    -> ë¡œê·¸ì¸ì‹œì— decodeí•˜ì—¬ ì›ë˜ ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„êµ í›„ ë¡œê·¸ì¸ í•´ì•¼í•¨

**ì½”ë“œ**
```python
    class Register(APIView):
        def post(self, request):
            data = request.data
            if data['password'] != data['password2']:
                return Response({"message": "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"},status=status.HTTP_400_BAD_REQUEST)
            content = {
                "email": data['email'],
                "password": bcrypt.hashpw(data['password'].encode("utf-8"), bcrypt.gensalt()).decode("utf-8"),
                "username": data['username']
            }
            serializer = UserSerializer(data=content)
            if serializer.is_valid():
                user = serializer.save()
                token = TokenObtainPairSerializer.get_token(user)
                refresh_token = str(token)
                access_token = str(token.access_token)
                response = Response(
                    {
                        "user": serializer.data,
                        "message": "register successs",
                        "token": {
                            "access": access_token,
                            "refresh": refresh_token,
                        },
                    },
                    status=status.HTTP_201_CREATED,
                )
                return response
            return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```
### 2. ë¡œê·¸ì¸
- `simple JWT ì¸ì¦ ë°©ì‹`ì„ ì´ìš©í•˜ì—¬ ë¡œê·¸ì¸í•œë‹¤.
- ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í•  ê²½ìš° access í† í°ê³¼ refresh í† í°ì„ ë°œê¸‰í•˜ì—¬ ì¿ í‚¤ì— ì €ì¥í•œë‹¤.
- access í† í° ì‚¬ìš© ì‹œê°„ì´ ë§Œë£Œë  ê²½ìš° Refresh í† í°ì„ í†µí•´ access í† í°ì„ ì¬ë°œê¸‰í•œë‹¤.
- íšŒì› ê°€ì…ì‹œ ì•”í˜¸í™” í•´ë†“ì•˜ë˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ decodeí•˜ì—¬ ë¹„êµí•˜ì—¬ì•¼ í•œë‹¤.

**ì½”ë“œ**
```python
class Login(APIView):
    def get(self, request):
        user = User.objects.values()
        return Response({"list" : list(user)}, status = 200)
    def post(self, request):
        data = request.data
        if User.objects.filter(email = data['email']).exists():
                user = User.objects.get(email = data['email'])
                if bcrypt.checkpw(data['password'].encode('utf-8'), user.password.encode('utf-8')) :
                    serializer = UserSerializer(user)
                    token = TokenObtainPairSerializer.get_token(user)
                    refresh_token = str(token)
                    access_token = str(token.access_token)
                    response = Response(
                        {
                            "user": serializer.data,
                            "message": "login success",
                            "token": {
                                "access": access_token,
                                "refresh": refresh_token,
                            },
                        },
                        status=status.HTTP_200_OK,
                    )
                    response.set_cookie("access", access_token, httponly=True)
                    response.set_cookie("refresh", refresh_token, httponly=True)
                    return response
                else:
                    return Response(status=status.HTTP_400_BAD_REQUEST)
        return Response({"message": "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤."}, status=status.HTTP_400_BAD_REQUEST)
```

### 3. ë¡œê·¸ì•„ì›ƒ
ë¡œê·¸ì¸ì‹œ ì¿ í‚¤ì— ì €ì¥í•´ë†“ì•˜ë˜ í† í°ì„ ì‚­ì œí•˜ì—¬ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬

**ì½”ë“œ**
```python
    class Logout(APIView):
            def post(self, request):
                data = request.data
                user = User.objects.get(email = data['email'])
                token = TokenObtainPairSerializer.get_token(user)
                response = Response(
                            {
                                "message": "success",
                            },
                            status=status.HTTP_200_OK,
                )
                response.delete_cookie("access")
                response.delete_cookie("refresh")
                return response
```